---
title: Celery
date: 2020-05-29 23:00:30
tags: Python
---

> 异步任务调度器

<!-- more -->


## 一. 简介

##### 1. 场景：
- 当前端用户注册时，会发送激活邮件给用户，发送邮件的过程耗时较长，会让前端页面等待太长时间；用户操作希望立即返回，耗时长的任务，只需返回"执行中"，后台自动执行完毕。
- 每天统计日活用户，每小时分析热点问题等，一系列定时操作的事项；类似 crontab 的定时任务调度器，并且具有防重机制。

##### 2. Celery 特点
- 异步调用，提交操作任务给 Celery，Celery 保存到任务队列，后台自动读取队列并执行。
- 定时调用，配置定时任务后，Celery 定时轮询，如果到达时间，就会插入任务到队列，并执行。


## 二. 原理

![](/img/2020/celery_one.jpg)


##### 1. task producer, application
调用 Celery 的API，函数，装饰器等产生任务交给任务队列，简称生成者。
一般是应用程序将需要异步执行的任务，提交到 Celery 任务队列。

##### 2. task schedules, celery beat
定时任务调度器，定时执行配置文件中的任务。
类似 crontab 的功能，定时将任务提交到 Celery 任务队列。

##### 3. task queue, broker
消息的中间件，接收生成者产生的消息，存储队列并分发给任务方进行消费。
由第三方提供消息队列，官方推荐 RabbitMQ

##### 4. task consumer, worker
任务执行的消费者，将队列里的任务，拿出来执行。
一般是应用程序异步执行的具体逻辑，比如发送邮件。


##### 5. result
异步任务处理完成后的结果储存。
可以保存到数据库，或者是缓存，比如 Redis

