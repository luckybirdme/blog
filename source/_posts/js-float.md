---
title: JS 浮点数
date: 2020-06-28 22:48:53
tags: JavaScript
---

> 浮点数

<!-- more -->

## 一. 数值底层表示
在 JavaScript 中所有数值都以 IEEE-754 标准的 64 bit 双精度浮点数进行存储的，最终保存到计算机是二进制形式。

1. 正整数二进制表示：14=1010=2^3+2^2+2^1
```js
14/2=7 余 0
7/2=3 余 1
3/2=1 余 1
1/2=0 余 1

逆序排列，从下到上：1110

```

2. 小数二进制表示：0.625=0.101=1/(2^1)+1/(2^3)

```js
0.625*2=1.25 取整为 1 余 0.25
0.25*2=0.5 取整为 0 余 0.5
0.5*2=1 取整为 1 余 0 , 停止
顺序排列，从上到下：01

```

3. 小数可能出现无限循环：0.4=0.0110 0110 0110 ···

```js
0.4*2=0.8 取整为 0 余 0.8
0.8*2=1.6 取整为 1 余 0.6
0.6*2=1.2 取整为 1 余 0.2
0.2*2=0.4 取整为 0 余 0.4 , 出现循环
```

## 二. 小数处理的误差
由JS保存小数机制可知，如果小数的二进制出现无限循环，超出 64 bit 时将会自动截断，因此 JS 处理小数可能会出现误差。

```js
console.log(0.1+0.2)
0.30000000000000004
```

常用的解决方法

1. 通过 Number.toFixed() 方法四舍五入，参数是保留小数个数

```js
console.log((0.1+0.2).toFixed(1))
0.3
```

2. 将小数变成整数，然后进行操作，最后再变回小数

```js
console.log((0.1*10+0.2*10)/10)
0.3

```

3. 使用现场的类库，实现小数的操作，比如[mathjs](https://github.com/josdejong/mathjs)

```js
// JS 原生小数处理方法
console.log(math.add(0.1,0.2))
// 配置 number 为 BigNumbers，较慢但精度较高
math.config({number: 'BigNumber'})
console.log(`${math.evaluate('0.1+0.2')}`)
```