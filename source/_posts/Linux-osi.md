---
title: OSI
date: 2020-04-11 12:45:19
tags: Linux
---

> OSI(Open System Interconnection), 开放式系统互联通信

<!-- more -->

### 一. 浏览器输入地址后

1. 在浏览器地址栏，输入 http://www.mysite.com

2. 浏览器通过 DNS 解释域名的 IP，即将要访问的主机 IP

3. 浏览器借助 TCP 协议，发起 HTTP 请求到 IP 指向的主机

4. 如果 IP 在同一个局域网，那么通过 ARP 协议就能找到主机的 MAC 地址

5. 以太网的交换机根据 MAC 地址和网线接口映射，把请求从对应的网线接口转发到具体主机上。

6. 如果 IP 不在当前局域网，那么必须通过网关把请求转发到广域网，寻找 IP 所在的局域网。

7. 在广域网转发请求需要借助路由器，路由器根据 IP 协议找到下一跳 MAC 地址，以此类推转发下去。

8. 经过多次路由转发，终于找到 IP 所在的局域网，该局域网也有网关，该网关把请求发给交换机。

9. 交换机根据 MAC 地址找到主机所在的网线接口，并转发请求到主机。

10. 主机根据 TCP 协议，解析出 HTTP 请求，处理完后，按照逆向的网络路径，把网页内容返回给浏览器。




##### 以上网络拓扑可简化成下图

![](/img/2020/OSI_three.png)



##### 对于请求的数据包流转，下图更详细

![](/img/2020/OSI_one.png)


##### 上述内容综合起来就七层 OSI 模型，下表是每一层的作用


![](/img/2020/OSI_detail_two.png)



### 二. 主机层 host layers

##### 1. 组成
- 应用层，具体应用程序，比如 QQ，微信等
- 表示层，数据格式转换，比如压缩，加密
- 会话层，管理发送和接收方的会话，比如认证
- 传输层，实现可靠的传输通道，TCP/UDP协议就在此层

##### 2. 核心：传输层
- 应用层，表示层，会话层主要由应用程序控制，允许应用程序自由实现，所以存在多种类型的应用协议，比如 HTTP，DNS，FTP，SSH等等

- 传输层主要为了给上层提供可靠的传输通道，并通过端口区分不同的应用程序通道，避免数据混乱。此层主要协议是 TCP，UDP，通过 socket 包装成抽象接口，提供上层应用程序协议使用；socket 接口也可以直接使用网络层的 IP、ICMP 协议。

- 由于媒介层只负责数据转发，是无状态、无连接的，不会重发，也不保证数据可达，所以必须借助传输层确保数据传输的可靠性、完整性。


![](/img/2020/Linux_socket.png)


### 三. 媒介层 media layers

##### 1. 组成
- 网络层，在广域网根据 IP 协议进行数据包的路由转发，路由器工作在此层
- 链路层，在局域网内根据 MAC 地址转发数据包到具体主机，交换机工作在此层
- 物理层，真实的物理介质，比如光纤，网线，通过载波进行 0 1 状态码的传输

##### 2. 核心：网络层
- 以前是先有局域网，在机房内或者多个机构比如学校，通过集线器进行数据广播传输，每个主机都能收到，如果广播的 MAC 地址跟自己相同，则进行接收。集线器是工作在链路层，优点是实现简单，能将多个小局域网组成大局域网，缺点是广播式传输的数据会充斥在整个连通的局域网，而且存在单点故障的风险。

- 后来发展出交换机，交换机维护了一份 MAC 地址和主机网线接口的映射表，当交换机收到数据包时，会根据 MAC 地址转发到对应的网线接口，即对应的主机，避免了集线器广播式传输的缺点，而且每个网线接口的带宽是独占的。

- 交换机依然只在局域网有效，它无法得知其他局域网的主机的 MAC 地址。而且世界上所有主机的 MAC 地址都保存在一台交换机上，也是不现实的。这时候就有 IP 地址分类的的协议，即 IP 协议。

- IP 协议规定每台主机绑定一个 IP 地址，局域网的主机 IP 是有规律的，比如 192.168.0.1,192.168.0.2,192.168.0.3, 根据 IP 地址就能大致找到主机的所在位置，即所在的局域网，然后找到该局域网的交换机，最后交换机再找到具体主机。此过程叫做路由转发，通过路由器实现，工作在网络层。

- 借助网络层的路由转发，任意局域内的主机都能访问其他区域网的主机，这是因特网的核心所在。


![](/img/2020/OSI_two.png)
